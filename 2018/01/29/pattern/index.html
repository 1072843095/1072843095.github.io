<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="js设计模式 单例模式保证一个类仅有一个实例，并提供一个访问它的全局访问点。 用代理实现单例模式">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript设计模式与开发实践笔记">
<meta property="og:url" content="https://1072843095.github.io/2018/01/29/pattern/index.html">
<meta property="og:site_name" content="还没想好">
<meta property="og:description" content="js设计模式 单例模式保证一个类仅有一个实例，并提供一个访问它的全局访问点。 用代理实现单例模式">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-03-27T04:44:39.819Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript设计模式与开发实践笔记">
<meta name="twitter:description" content="js设计模式 单例模式保证一个类仅有一个实例，并提供一个访问它的全局访问点。 用代理实现单例模式">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://1072843095.github.io/2018/01/29/pattern/">





  <title> JavaScript设计模式与开发实践笔记 | 还没想好 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">还没想好</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">也还没想好</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://1072843095.github.io/2018/01/29/pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chris Han">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/head.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="还没想好">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                JavaScript设计模式与开发实践笔记
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-29T14:33:19+08:00">
                2018-01-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/学习笔记/" itemprop="url" rel="index">
                    <span itemprop="name">学习笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>js设计模式</p>
<h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><p>保证一个类仅有一个实例，并提供一个访问它的全局访问点。</p>
<h4 id="用代理实现单例模式"><a href="#用代理实现单例模式" class="headerlink" title="用代理实现单例模式"></a>用代理实现单例模式</h4><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">var CreateDiv = function(html)&#123;</span><br><span class="line">	this.html = html;</span><br><span class="line">	this.init();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CreateDiv.prototype.init = function()&#123;</span><br><span class="line">	var div = document.createElement(&apos;div&apos;);</span><br><span class="line">	div.innerHTML = this.html;</span><br><span class="line">	document.body.appendChild(div);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//代理类</span><br><span class="line">var ProxySingletonCreaterDiv = (function()&#123;</span><br><span class="line">	var instance;</span><br><span class="line">	return function(html)&#123;</span><br><span class="line">		if(!instance)&#123;</span><br><span class="line">			instance = new CreateDiv(html);</span><br><span class="line">		&#125;</span><br><span class="line">		return instance;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">var a = new ProxySingletonCreaterDiv(&apos;sven1&apos;);</span><br><span class="line">var b = new ProxySingletonCreaterDiv(&apos;sven2&apos;);</span><br><span class="line">alert(a===b);  // true</span><br></pre></td></tr></table></figure>
<h4 id="js中的单例模式"><a href="#js中的单例模式" class="headerlink" title="js中的单例模式"></a>js中的单例模式</h4><h5 id="使用命名空间-减少全局变量的数量"><a href="#使用命名空间-减少全局变量的数量" class="headerlink" title="使用命名空间,减少全局变量的数量"></a>使用命名空间,减少全局变量的数量</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var namespace1 = &#123;</span><br><span class="line">	a: function()&#123;</span><br><span class="line">		alert(1)</span><br><span class="line">	   &#125;,</span><br><span class="line">	b: function()&#123;</span><br><span class="line">		alert(2)</span><br><span class="line">	   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="使用闭包封装私有变量，只暴露一些接口跟外界通信"><a href="#使用闭包封装私有变量，只暴露一些接口跟外界通信" class="headerlink" title="使用闭包封装私有变量，只暴露一些接口跟外界通信"></a>使用闭包封装私有变量，只暴露一些接口跟外界通信</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var user = (function()&#123;</span><br><span class="line">	var _name = &apos;sven&apos;,</span><br><span class="line">		_age = 29;</span><br><span class="line"></span><br><span class="line">	return&#123;</span><br><span class="line">		getUserInfo: function()&#123;</span><br><span class="line">			return _name+&apos;-&apos;+_age;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h4 id="惰性单例"><a href="#惰性单例" class="headerlink" title="惰性单例"></a>惰性单例</h4><p>惰性单例指的是在需要的时候才创建对象实例。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//管理单例</span><br><span class="line">var getSingle = function(fn)&#123;</span><br><span class="line">	var result;</span><br><span class="line">	return function()&#123;</span><br><span class="line">		return result || (result=fn.apply(this, argument));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var createSingleIframe = getSingle( function()&#123;</span><br><span class="line">	var iframe = document.createElement ( &apos;iframe&apos; );</span><br><span class="line">	document.body.appendChild( iframe );</span><br><span class="line">	return iframe;</span><br><span class="line">&#125;);</span><br><span class="line">document.getElementById( &apos;loginBtn&apos; ).onclick = function()&#123;</span><br><span class="line">	var loginLayer = createSingleIframe();</span><br><span class="line">	loginLayer.src = &apos;http://baidu.com&apos;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h3 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h3><p>定义一系列的算法，把它们一个个封装起来，并且使它们可以相互替换。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var strategies = &#123;</span><br><span class="line">	&quot;S&quot;: function(salary)&#123;</span><br><span class="line">		return salary*4;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;A&quot;: function(salary)&#123;</span><br><span class="line">		return salary*3;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;B&quot;: function(salary)&#123;</span><br><span class="line">		return salary*2;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var calculateBonus = function(level, salary)&#123;</span><br><span class="line">	return strategies[level](salary);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(calculateBonus(&quot;S&quot;, 20000));   //80000</span><br><span class="line">console.log(calculateBonus(&quot;A&quot;, 10000));   //30000</span><br></pre></td></tr></table></figure></p>
<h4 id="使用策略模式重构表单校验"><a href="#使用策略模式重构表单校验" class="headerlink" title="使用策略模式重构表单校验"></a>使用策略模式重构表单校验</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">var strategies = &#123;</span><br><span class="line">	isNonEmpty: function(value, errorMsg)&#123;</span><br><span class="line">		if(value === &apos;&apos;)&#123;</span><br><span class="line">			return errorMsg;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	minLength: function(value, length, errorMsg)&#123;</span><br><span class="line">		if(value.length &lt; length)&#123;</span><br><span class="line">			return errorMsg;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	isMobile: function(value, errorMsg)&#123;</span><br><span class="line">		if(!/^1[3|5|8][0-9]&#123;9&#125;$/.test(value))&#123;</span><br><span class="line">			return errorMsg;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var Validator = function()&#123;</span><br><span class="line">	this.cache = [];//保存校验规则</span><br><span class="line">&#125;;</span><br><span class="line">Validator.prototype.add = function(dom, rules)&#123;</span><br><span class="line">	var self = this;</span><br><span class="line">	for(var i=0,rule; rule=rules[i++];)&#123;</span><br><span class="line">		(function(rule)&#123;</span><br><span class="line">			var strategyAry = rule.strategy.split(&quot;:&quot;); // 把 strategy 和参数分开</span><br><span class="line">			var errorMsg = rule.errorMsg;</span><br><span class="line"></span><br><span class="line">			self.cache.push(function()&#123;  // 把校验的步骤用空函数包装起来，并且放入 cache</span><br><span class="line">				var strategy = strategyAry.shift(); // 用户挑选的 strategy</span><br><span class="line">				strategyAry.unshift(dom.value);  // 把 input 的 value 添加进参数列表</span><br><span class="line">				strategyAry.push(errorMsg);   // 把 errorMsg 添加进参数列表</span><br><span class="line">				return strategies[strategy].apply(dom, strategyAry);</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;)(rule)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Validator.prototype.start = function()&#123;</span><br><span class="line">	for(var i=0,validatorFunc; validatorFunc=this.cache[i++];)&#123;</span><br><span class="line">		var msg = validatorFunc();  //开始校验，并取得校验后的返回信息</span><br><span class="line">		if(msg)&#123; //如果有确切的返回值，说明校验没有通过</span><br><span class="line">			return msg;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//使用</span><br><span class="line">var validataFunc = function()&#123;</span><br><span class="line">	var validator = new Validator();//创建一个validate对象</span><br><span class="line">	/****添加一些校验规则****/</span><br><span class="line">	validator.add(registerForm.userName, [&#123;strategy:&apos;isNonEmpty&apos;, errorMsg:&apos;用户名不能为空&apos;&#125;, &#123;strategy:&apos;minLength:6&apos;, errorMsg:&apos;用户名长度不能少于6位&apos;&#125;]);</span><br><span class="line">	validator.add(registerForm.password, [&#123;strategy:&apos;minLength:6&apos;, errorMsg:&apos;密码长度不能少于6位&apos;&#125;]);</span><br><span class="line">	validator.add(registerForm.phoneNumber, [&#123;strategy:&apos;isMobile&apos;, errorMsg:&apos;手机号码格式不正确&apos;&#125;]);</span><br><span class="line"></span><br><span class="line">	var errorMsg = validator.start();//获取校验结果</span><br><span class="line">	return errorMsg; //返回校验结果</span><br><span class="line">&#125;</span><br><span class="line">var registerForm = document.getElementById(&apos;registerForm&apos;);</span><br><span class="line">registerForm.onsubmit = function()&#123;</span><br><span class="line">	var errorMsg = validataFunc();   //如果errorMsg有确切的返回值，说明未通过校验</span><br><span class="line">	if(errorMsg)&#123;</span><br><span class="line">		alert(errorMsg);</span><br><span class="line">		return false;//阻止表单提交</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>代理模式是为一个对象提供一个代用品或占位符，以便控制对它的访问。</p>
<h4 id="虚拟代理实现图片预加载"><a href="#虚拟代理实现图片预加载" class="headerlink" title="虚拟代理实现图片预加载"></a>虚拟代理实现图片预加载</h4><p>在web开发中，图片预加载是一种常见的技术，如果直接给某个img标签节点设置src属性，由于图片过大或者网络不佳，图片的位置往往有段时间会是一片空白。常见的做法是先用一张loading图片站位，然后用异步的方式加载土坯阿尼，等图片加载好了再把它填充到img节点里，这种场景就很适合虚拟代理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">var myImage = (function()&#123;</span><br><span class="line">	var imgNode = document.createElement(&apos;img&apos;);</span><br><span class="line">	document.body.appendChild(imgNode);</span><br><span class="line">	return&#123;</span><br><span class="line">		setSrc: function(src)&#123;</span><br><span class="line">			imgNode.src = src;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">var proxyImage = (function()&#123;</span><br><span class="line">	var img = new Image();</span><br><span class="line">	img.onload = function()&#123;</span><br><span class="line">		myImage.setSrc(this.src);</span><br><span class="line">	&#125;</span><br><span class="line">	return &#123;</span><br><span class="line">		setSrc: function(src)&#123;</span><br><span class="line">			myImage.setSrc( &apos;file:// /C:/Users/svenzeng/Desktop/loading.gif&apos; );</span><br><span class="line">			img.src = src;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br><span class="line">proxyImage.setSrc( &apos;http:// imgcache.qq.com/music/photo/k/000GGDys0yA0Nk.jpg&apos; );</span><br></pre></td></tr></table></figure></p>
<h4 id="虚拟代理合并http请求"><a href="#虚拟代理合并http请求" class="headerlink" title="虚拟代理合并http请求"></a>虚拟代理合并http请求</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">var synchronousFile = function(id)&#123;</span><br><span class="line">	console.log(&apos;开始同步文件，id为：&apos;+id);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var proxySynchronousFile = (function()&#123;</span><br><span class="line">	var cache = [],   //保存一段时间内需要同步的id</span><br><span class="line">		timer;    //定时器</span><br><span class="line">	return function(id)&#123;</span><br><span class="line">		cache.push(id);</span><br><span class="line">		if(timer)&#123; //确保不会覆盖已经启动的定时器</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		timer = setTimeout(function()&#123;</span><br><span class="line">			synchronousFile(cache.join(&apos;,&apos;));  //2秒后向本体发送需要同步的id集合</span><br><span class="line">			clearTimeout(timer);  //清空定时器</span><br><span class="line">			timer = null;</span><br><span class="line">			cache.length = 0;  //清空id集合</span><br><span class="line">		&#125;, 2000);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br><span class="line">var checkbox = document.getElementByTagName(&apos;input&apos;);</span><br><span class="line">for(var i=0,c; c=checkbox[i++];)&#123;</span><br><span class="line">	c.onclick = function()&#123;</span><br><span class="line">		if(this.checked === true)&#123;</span><br><span class="line">			proxySynchronousFile(this.id);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="用高阶函数动态创建代理"><a href="#用高阶函数动态创建代理" class="headerlink" title="用高阶函数动态创建代理"></a>用高阶函数动态创建代理</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">/**************** 计算乘积 *****************/</span><br><span class="line">var mult = function()&#123;</span><br><span class="line">	var a = 1;</span><br><span class="line">	for ( var i = 0, l = arguments.length; i &lt; l; i++ )&#123;</span><br><span class="line">		a = a * arguments[i];</span><br><span class="line">	&#125;</span><br><span class="line">	return a;</span><br><span class="line">&#125;;</span><br><span class="line">/**************** 计算加和 *****************/</span><br><span class="line">var plus = function()&#123;</span><br><span class="line">	var a = 0;</span><br><span class="line">	for ( var i = 0, l = arguments.length; i &lt; l; i++ )&#123;</span><br><span class="line">		a = a + arguments[i];</span><br><span class="line">	&#125;</span><br><span class="line">	return a;</span><br><span class="line">&#125;;</span><br><span class="line">/**************** 创建缓存代理的工厂 *****************/</span><br><span class="line">var createProxyFactory = function( fn )&#123;</span><br><span class="line">	var cache = &#123;&#125;;</span><br><span class="line">	return function()&#123;</span><br><span class="line">		var args = Array.prototype.join.call( arguments, &apos;,&apos; );</span><br><span class="line">		if ( args in cache )&#123;</span><br><span class="line">			return cache[ args ];</span><br><span class="line">		&#125;</span><br><span class="line">		return cache[ args ] = fn.apply( this, arguments );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var proxyMult = createProxyFactory( mult ),</span><br><span class="line">proxyPlus = createProxyFactory( plus );</span><br><span class="line">alert ( proxyMult( 1, 2, 3, 4 ) ); // 输出：24</span><br><span class="line">alert ( proxyMult( 1, 2, 3, 4 ) ); // 输出：24</span><br><span class="line">alert ( proxyPlus( 1, 2, 3, 4 ) ); // 输出：10</span><br><span class="line">alert ( proxyPlus( 1, 2, 3, 4 ) ); // 输出：10</span><br></pre></td></tr></table></figure>
<h3 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h3><p>迭代器模式是指提供一种方法顺序访问一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示。js内置了迭代器。forEach，for in等。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">var getActiveUploadObj = function()&#123;</span><br><span class="line">	try&#123;</span><br><span class="line">		return new ActiveXObject( &quot;TXFTNActiveX.FTNUpload&quot; ); // IE 上传控件</span><br><span class="line">	&#125;catch(e)&#123;</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var getFlashUploadObj = function()&#123;</span><br><span class="line">	if ( supportFlash() )&#123; // supportFlash 函数未提供</span><br><span class="line">		var str = &apos;&lt;object type=&quot;application/x-shockwave-flash&quot;&gt;&lt;/object&gt;&apos;;</span><br><span class="line">		return $( str ).appendTo( $(&apos;body&apos;) );</span><br><span class="line">	&#125;</span><br><span class="line">	return false;</span><br><span class="line">&#125;;</span><br><span class="line">var getFormUpladObj = function()&#123;</span><br><span class="line">	var str = &apos;&lt;input name=&quot;file&quot; type=&quot;file&quot; class=&quot;ui-file&quot;/&gt;&apos;; // 表单上传</span><br><span class="line">	return $( str ).appendTo( $(&apos;body&apos;) );</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line">var iteratorUploadObj = function()&#123;</span><br><span class="line">	for ( var i = 0, fn; fn = arguments[ i++ ]; )&#123;</span><br><span class="line">		var uploadObj = fn();</span><br><span class="line">		if ( uploadObj !== false )&#123;</span><br><span class="line">			return uploadObj;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var uploadObj = iteratorUploadObj( getActiveUploadObj, getFlashUploadObj, getFormUpladObj );</span><br></pre></td></tr></table></figure><br>获取不同上传对象的方法被隔离在各自的函数里互不干扰，try 、 catch 和 if 分支不再纠缠在一起，使得我们可以很方便地的维护和扩展代码。比如，后来我们又给上传项目增加了 Webkit控件上传和 HTML5上传，我们要做的仅仅是下面一些工作</p>
<h3 id="发布-订阅模式（观察者模式）"><a href="#发布-订阅模式（观察者模式）" class="headerlink" title="发布-订阅模式（观察者模式）"></a>发布-订阅模式（观察者模式）</h3><p>它定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">var event = &#123;</span><br><span class="line">	clientList: [],</span><br><span class="line">	listen: function( key, fn )&#123;</span><br><span class="line">		if ( !this.clientList[ key ] )&#123;</span><br><span class="line">			this.clientList[ key ] = [];</span><br><span class="line">		&#125;</span><br><span class="line">		this.clientList[ key ].push( fn ); // 订阅的消息添加进缓存列表</span><br><span class="line">	&#125;,</span><br><span class="line">	trigger: function()&#123;</span><br><span class="line">		var key = Array.prototype.shift.call( arguments ), // (1);</span><br><span class="line">		fns = this.clientList[ key ];</span><br><span class="line">		if ( !fns || fns.length === 0 )&#123; // 如果没有绑定对应的消息</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		for( var i = 0, fn; fn = fns[ i++ ]; )&#123;</span><br><span class="line">			fn.apply( this, arguments ); // (2) // arguments 是 trigger 时带上的参数</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	remove: function( key, fn )&#123;</span><br><span class="line">		var fns = this.clientList[ key ];</span><br><span class="line">		if ( !fns )&#123; // 如果 key 对应的消息没有被人订阅，则直接返回</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		if ( !fn )&#123; // 如果没有传入具体的回调函数，表示需要取消 key 对应消息的所有订阅</span><br><span class="line">			fns &amp;&amp; ( fns.length = 0 );</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			for ( var l = fns.length - 1; l &gt;=0; l-- )&#123; // 反向遍历订阅的回调函数列表</span><br><span class="line">				var _fn = fns[ l ];</span><br><span class="line">				if ( _fn === fn )&#123;</span><br><span class="line">					fns.splice( l, 1 ); // 删除订阅者的回调函数</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br><span class="line">var installEvent = function( obj )&#123;</span><br><span class="line">	for ( var i in event )&#123;</span><br><span class="line">		obj[ i ] = event[ i ];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//使用</span><br><span class="line">var salesOffices = &#123;&#125;;</span><br><span class="line">installEvent( salesOffices );</span><br><span class="line">salesOffices.listen( &apos;squareMeter88&apos;, fn1 = function( price )&#123; // 小明订阅消息</span><br><span class="line">	console.log( &apos;价格= &apos; + price );</span><br><span class="line">&#125;);</span><br><span class="line">salesOffices.listen( &apos;squareMeter88&apos;, fn2 = function( price )&#123; // 小红订阅消息</span><br><span class="line">	console.log( &apos;价格= &apos; + price );</span><br><span class="line">&#125;);</span><br><span class="line">salesOffices.remove( &apos;squareMeter88&apos;, fn1 ); // 删除小明的订阅</span><br><span class="line">salesOffices.trigger( &apos;squareMeter88&apos;, 2000000 ); // 输出：2000000</span><br></pre></td></tr></table></figure></p>
<h4 id="真实的例子——网站登录"><a href="#真实的例子——网站登录" class="headerlink" title="真实的例子——网站登录"></a>真实的例子——网站登录</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$.ajax( &apos;http:// xxx.com?login&apos;, function(data)&#123; // 登录成功</span><br><span class="line">	login.trigger( &apos;loginSucc&apos;, data); // 发布登录成功的消息</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//各模块监听登录成功的消息：</span><br><span class="line">var header = (function()&#123; // header 模块</span><br><span class="line">	login.listen( &apos;loginSucc&apos;, function( data)&#123;</span><br><span class="line">		header.setAvatar( data.avatar );</span><br><span class="line">	&#125;);</span><br><span class="line">	return &#123;</span><br><span class="line">		setAvatar: function( data )&#123;</span><br><span class="line">			console.log( &apos;设置 header 模块的头像&apos; );</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br><span class="line">var nav = (function()&#123; // nav 模块</span><br><span class="line">	login.listen( &apos;loginSucc&apos;, function( data )&#123;</span><br><span class="line">		nav.setAvatar( data.avatar );</span><br><span class="line">	&#125;);</span><br><span class="line">	return &#123;</span><br><span class="line">		setAvatar: function( avatar )&#123;</span><br><span class="line">			console.log( &apos;设置 nav 模块的头像&apos; );</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><p>用闭包实现对的命令模式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">var setCommand = function(button, command)&#123;</span><br><span class="line">	button.onclick = function()&#123;</span><br><span class="line">		command.execute();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var MenuBar = &#123;</span><br><span class="line">	refresh: function()&#123;</span><br><span class="line">		console.log(&apos;刷新界面&apos;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var RefreshMenuBarCommand = function(receiver)&#123;</span><br><span class="line">	return &#123;</span><br><span class="line">		execute:function()&#123;</span><br><span class="line">			receiver.refresh();</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var refreshMenuBarCommand = RefreshMenuBarCommand(MenuBar);</span><br><span class="line"></span><br><span class="line">setCommand(button1, refreshMenuBarCommand);</span><br></pre></td></tr></table></figure></p>
<p>宏命令:宏命令是一组命令的集合，通过执行宏命令的方式，可以一次执行一批命令。宏命令是命令模式与组合模式的联用产物.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">var closeDoorCommand = &#123;</span><br><span class="line">	execute: function()&#123;</span><br><span class="line">		console.log( &apos;关门&apos; );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var openPcCommand = &#123;</span><br><span class="line">	execute: function()&#123;</span><br><span class="line">		console.log( &apos;开电脑&apos; );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var openQQCommand = &#123;</span><br><span class="line">	execute: function()&#123;</span><br><span class="line">		console.log( &apos;登录 QQ&apos; );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var MacroCommand = function()&#123;</span><br><span class="line">	return &#123;</span><br><span class="line">		commandsList: [],</span><br><span class="line">		add: function( command )&#123;</span><br><span class="line">			this.commandsList.push( command );</span><br><span class="line">		&#125;,</span><br><span class="line">		execute: function()&#123;</span><br><span class="line">			for ( var i = 0, command; command = this.commandsList[ i++ ]; )&#123;</span><br><span class="line">				command.execute();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var macroCommand = MacroCommand();</span><br><span class="line">macroCommand.add( closeDoorCommand );</span><br><span class="line">macroCommand.add( openPcCommand );</span><br><span class="line">macroCommand.add( openQQCommand );</span><br><span class="line">macroCommand.execute();</span><br></pre></td></tr></table></figure></p>
<h3 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h3><p>组合模式就是用小的子对象来构建更大的对象，而这些小的子对象本身也许是由更小的“孙对象”构成的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">var MacroCommand = function()&#123;</span><br><span class="line">	return &#123;</span><br><span class="line">		commandsList: [],</span><br><span class="line">		add: function(command)&#123;</span><br><span class="line">			this.commandsList.push(command);</span><br><span class="line">		&#125;,</span><br><span class="line">		execute: function()&#123;</span><br><span class="line">			for(var i=0,command; command=this.commandsList[i++];)&#123;</span><br><span class="line">				command.execute();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var openAcCommand = &#123;</span><br><span class="line">	execute: function()&#123;</span><br><span class="line">		console.log(&apos;打开空调&apos;)；</span><br><span class="line">	&#125;</span><br><span class="line">&#125;；</span><br><span class="line"></span><br><span class="line">/*************家里的电视和音响是连接在一起的，所以可以用一个宏命令来组合打开电视和打开音响的命令*****************/</span><br><span class="line">var openTvCommand = &#123;</span><br><span class="line">	execute:function()&#123;</span><br><span class="line">		console.log(&apos;打开空调&apos;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var openSoundCommand = &#123;</span><br><span class="line">	execute: function()&#123;</span><br><span class="line">		console.log(&apos;打开音响&apos;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var macroCommand1 = MacroCommand();</span><br><span class="line">macroCommand1.add(openTvCommand);</span><br><span class="line">macroCommand1.add(openSoundCommand);</span><br><span class="line"></span><br><span class="line">/*******关门，打开电脑和登录qq的命令**********/</span><br><span class="line">var closeDoorCommand = &#123;</span><br><span class="line">	execute: function()&#123;</span><br><span class="line">		console.log(&apos;关门&apos;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var openPcCommand = &#123;</span><br><span class="line">	execute: function()&#123;</span><br><span class="line">		console.log(&apos;开电脑&apos;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var openQQCommand = &#123;</span><br><span class="line">	execute: function()&#123;</span><br><span class="line">		console.log(&apos;登录qq&apos;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var macroCommand2 = MacroCommand();</span><br><span class="line">macroCommand2.add(closeDoorCommand);</span><br><span class="line">macroCommand2.add(openPcCommand);</span><br><span class="line">macroCommand2.add(openQQCommand);</span><br><span class="line"></span><br><span class="line">/*********现在把所有的命令组合成一个“超级命令”**********/</span><br><span class="line">var macroCommand = MacroCommand();</span><br><span class="line">macroCommand.add( openAcCommand );</span><br><span class="line">macroCommand.add( macroCommand1 );</span><br><span class="line">macroCommand.add( macroCommand2 );</span><br><span class="line">/*********最后给遥控器绑定“超级命令”**********/</span><br><span class="line">var setCommand = (function( command )&#123;</span><br><span class="line">	document.getElementById( &apos;button&apos; ).onclick = function()&#123;</span><br><span class="line">		command.execute();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)( macroCommand )</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>组合模式的例子—扫描文件夹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">/****Folder***/</span><br><span class="line">var Folder = function(name)&#123;</span><br><span class="line">	this.name = name;</span><br><span class="line">	this.parent = null; //增加 this.parent 属性</span><br><span class="line">	this.files = [];</span><br><span class="line">&#125;;</span><br><span class="line">Folder.prototype.add = function(file)&#123;</span><br><span class="line">	file.parent = this; //设置父对象</span><br><span class="line">	this.files.push(file);</span><br><span class="line">&#125;;</span><br><span class="line">Folder.prototype.scan = function()&#123;</span><br><span class="line">	console.log(&apos;开始扫描文件夹：&apos;+this.name);</span><br><span class="line">	for(var i=0,file,files=this.files; file=files[i++];)&#123;</span><br><span class="line">		file.scan();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Folder.prototype.remove = function()&#123;</span><br><span class="line">	if ( !this.parent )&#123; //根节点或者树外的游离节点</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	for ( var files = this.parent.files, l = files.length - 1; l &gt;=0; l-- )&#123;</span><br><span class="line">		var file = files[ l ];</span><br><span class="line">		if ( file === this )&#123;</span><br><span class="line">			files.splice( l, 1 );</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">/******File*****/</span><br><span class="line">var File = function(name)&#123;</span><br><span class="line">	this.name = name;</span><br><span class="line">	this.parent = null;</span><br><span class="line">&#125;;</span><br><span class="line">File.prototype.add = function()&#123;</span><br><span class="line">	throw new Error(&apos;文件下面不能再添加文件&apos;);</span><br><span class="line">&#125;;</span><br><span class="line">File.prototype.scan = function()&#123;</span><br><span class="line">	console.log(&apos;开始扫描文件:&apos;+this.name);</span><br><span class="line">&#125;</span><br><span class="line">File.prototype.remove = function()&#123;</span><br><span class="line">	if ( !this.parent )&#123; //根节点或者树外的游离节点</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	for ( var files = this.parent.files, l = files.length - 1; l &gt;=0; l-- )&#123;</span><br><span class="line">		var file = files[ l ];</span><br><span class="line">		if ( file === this )&#123;</span><br><span class="line">			files.splice( l, 1 );</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var folder = new Folder(&apos;学习资料&apos;);</span><br><span class="line">var folder1 = new Folder(&apos;JavaScript&apos;);</span><br><span class="line">var folder2 = new Folder(&apos;jQuery&apos;);</span><br><span class="line"></span><br><span class="line">var file1 = new File(&apos;JavaScript设计模式与开发实战&apos;);</span><br><span class="line">var file2 = new File(&apos;精通jQuery&apos;);</span><br><span class="line">var file3 = new File(&apos;重构与模式&apos;);</span><br><span class="line"></span><br><span class="line">//现有文件目录结构</span><br><span class="line">folder1.add(file1);</span><br><span class="line">folder2.add(file2);</span><br><span class="line">folder.add(folder1);</span><br><span class="line">folder.add(folder2);</span><br><span class="line">folder.add(file3);</span><br><span class="line"></span><br><span class="line">//需要增加的新的数据</span><br><span class="line">var folder3 = new Folder( &apos;Nodejs&apos; );</span><br><span class="line">var file4 = new File( &apos;深入浅出 Node.js&apos; );</span><br><span class="line">folder3.add( file4 );</span><br><span class="line">var file5 = new File( &apos;JavaScript 语言精髓与编程实践&apos; );</span><br><span class="line"></span><br><span class="line">//把这些文件都添加到原有的树中</span><br><span class="line">folder.add( folder3 );</span><br><span class="line">folder.add( file5 );</span><br><span class="line"></span><br><span class="line">//移除文件夹</span><br><span class="line">folder1.remove();</span><br><span class="line"></span><br><span class="line">//扫描整个文件夹</span><br><span class="line">folder.scan();</span><br></pre></td></tr></table></figure></p>
<h3 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h3><p>模板方法模式是一种典型的通过封装变化提高系统扩展性的设计模式。但在JavaScript中，我们很多时候都不需要依样画瓢地去实现一个模版方法模式，高阶函数<br>是更好的选择。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">var Beverage = function()&#123;&#125;;</span><br><span class="line">Beverage.prototype.boilWater = function()&#123;</span><br><span class="line">	console.log( &apos;把水煮沸&apos; );</span><br><span class="line">&#125;;</span><br><span class="line">Beverage.prototype.brew = function()&#123;</span><br><span class="line">	throw new Error( &apos;子类必须重写 brew 方法&apos; );</span><br><span class="line">&#125;;</span><br><span class="line">Beverage.prototype.pourInCup = function()&#123;</span><br><span class="line">	throw new Error( &apos;子类必须重写 pourInCup 方法&apos; );</span><br><span class="line">&#125;;</span><br><span class="line">Beverage.prototype.addCondiments = function()&#123;</span><br><span class="line">	throw new Error( &apos;子类必须重写 addCondiments 方法&apos; );</span><br><span class="line">&#125;;</span><br><span class="line">Beverage.prototype.customerWantsCondiments = function()&#123;</span><br><span class="line">	return true; // 默认需要调料</span><br><span class="line">&#125;;</span><br><span class="line">Beverage.prototype.init = function()&#123;</span><br><span class="line">	this.boilWater();</span><br><span class="line">	this.brew();</span><br><span class="line">	this.pourInCup();</span><br><span class="line">	if ( this.customerWantsCondiments() )&#123; // 如果挂钩返回 true，则需要调料</span><br><span class="line">		this.addCondiments();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var CoffeeWithHook = function()&#123;&#125;;</span><br><span class="line">CoffeeWithHook.prototype = new Beverage();</span><br><span class="line">CoffeeWithHook.prototype.brew = function()&#123;</span><br><span class="line">	console.log( &apos;用沸水冲泡咖啡&apos; );</span><br><span class="line">&#125;;</span><br><span class="line">CoffeeWithHook.prototype.pourInCup = function()&#123;</span><br><span class="line">	console.log( &apos;把咖啡倒进杯子&apos; );</span><br><span class="line">&#125;;</span><br><span class="line">CoffeeWithHook.prototype.addCondiments = function()&#123;</span><br><span class="line">	console.log( &apos;加糖和牛奶&apos; );</span><br><span class="line">&#125;;</span><br><span class="line">CoffeeWithHook.prototype.customerWantsCondiments = function()&#123;</span><br><span class="line">	return window.confirm( &apos;请问需要调料吗？&apos; );</span><br><span class="line">&#125;;</span><br><span class="line">var coffeeWithHook = new CoffeeWithHook();</span><br><span class="line">coffeeWithHook.init();</span><br></pre></td></tr></table></figure></p>
<h3 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h3><p>是一种用于性能优化的模式,核心是运用共享技术来有效支持大量细粒度的对象。如果系统中因为创建了大量类似的对象而导致内存占用过高，享元模式就非常有用了。享元模式要求将对象的属性划分为内部状态与外部<br>状态（状态在这里通常指属性）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.内部状态储存于对象内部。</span><br><span class="line">2.内部状态可以被一些对象共享。</span><br><span class="line">3.内部状态独立于具体的场景，通常不会改变。</span><br><span class="line">4.外部状态取决于具体的场景，并根据场景而变化，外部状态不能被共享。</span><br></pre></td></tr></table></figure><br>对象池维护一个装载空闲对象的池子，如果需要对象的时候，不是直接 new，而是转从对象池里获取。如果对象池里没有空闲对象，则创建一个新的对象，当获取出的对象完成它的职责之后， 再进入池子等待被下次获取。</p>
<h3 id="职责链模式"><a href="#职责链模式" class="headerlink" title="职责链模式"></a>职责链模式</h3><p>一系列可能会处理请求的对象被连接成一条链，请求在这些对象之间依次传递，直到遇到一个可以处理它的对象，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">var order500 = function(orderType, pay, stock)&#123;</span><br><span class="line">	if(orderType===1 &amp;&amp; pay===true)&#123;</span><br><span class="line">		console.log(&apos;500元定金预购，得到100优惠券&apos;);</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		return &apos;nextSuccessor&apos;;  //我不知道下一个节点是谁，反正把请求往后传递</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var order200 = function(orderType, pay, stock)&#123;</span><br><span class="line">	if(orderType===2 &amp;&amp; pay===true)&#123;</span><br><span class="line">		console.log(&apos;200元定金预购，得到100优惠券&apos;);</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		return &apos;nextSuccessor&apos;;  //我不知道下一个节点是谁，反正把请求往后传递</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var orderNormal = function(orderType, pay, stock)&#123;</span><br><span class="line">	if(orderType===2 &amp;&amp; pay===true)&#123;</span><br><span class="line">		console.log(&apos;普通购买，无优惠券&apos;);</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		console.log(&apos;手机库存不足&apos;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//Chain.prototype.setNextSuccessor 指定在链中的下一个节点</span><br><span class="line">//Chain.prototype.passRequest  传递请求给某个节点</span><br><span class="line">var Chain = function(fn)&#123;</span><br><span class="line">	this.fn = fn;</span><br><span class="line">	this.successor = null;</span><br><span class="line">&#125;;</span><br><span class="line">Chain.prototype.setNextSuccessor = function(successor)&#123;</span><br><span class="line">	return this.successor = successor;</span><br><span class="line">&#125;;</span><br><span class="line">Chain.prototype.passRequest = function()&#123;</span><br><span class="line">	var ret = this.fn.apply(this, arguments);</span><br><span class="line">	if(ret === &apos;nextSuccessor&apos;)&#123;</span><br><span class="line">		return this.successor &amp;&amp; this.successor.passRequest.apply(this.successor, arguments);</span><br><span class="line">	&#125;</span><br><span class="line">	return ret;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var chainOrder500 = new Chain(order500);</span><br><span class="line">var chainOrder200 = new Chain(order200);</span><br><span class="line">var chainOrderNormal = new Chain(orderNormal);</span><br><span class="line">chainOrder500.setNextSuccessor( chainOrder200 );</span><br><span class="line">chainOrder200.setNextSuccessor( chainOrderNormal );</span><br><span class="line">chainOrder500.passRequest( 1, true, 500 ); // 输出：500 元定金预购，得到 100 优惠券</span><br><span class="line">chainOrder500.passRequest( 2, true, 500 ); // 输出：200 元定金预购，得到 50 优惠券</span><br><span class="line">chainOrder500.passRequest( 3, true, 500 ); // 输出：普通购买，无优惠券</span><br><span class="line">chainOrder500.passRequest( 1, false, 0 ); // 输出：手机库存不足</span><br></pre></td></tr></table></figure><br>异步职责链.异步的职责链加上命令模式（把 ajax请求封装成命令对象，详情请参考第 9章），我们可以很方便地创建一个异步 ajax队列库。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Chain.prototype.next= function()&#123;</span><br><span class="line">	return this.successor &amp;&amp; this.successor.passRequest.apply( this.successor, arguments );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//使用</span><br><span class="line">var fn1 = new Chain(function()&#123;</span><br><span class="line">	console.log( 1 );</span><br><span class="line">	return &apos;nextSuccessor&apos;;</span><br><span class="line">&#125;);</span><br><span class="line">var fn2 = new Chain(function()&#123;</span><br><span class="line">	console.log( 2 );</span><br><span class="line">	var self = this;</span><br><span class="line">	setTimeout(function()&#123;</span><br><span class="line">		self.next();</span><br><span class="line">	&#125;, 1000 );</span><br><span class="line">&#125;);</span><br><span class="line">var fn3 = new Chain(function()&#123;</span><br><span class="line">	console.log( 3 );</span><br><span class="line">&#125;);</span><br><span class="line">fn1.setNextSuccessor( fn2 ).setNextSuccessor( fn3 );</span><br><span class="line">fn1.passRequest();</span><br></pre></td></tr></table></figure><br>AOP实现.用 AOP 来实现职责链既简单又巧妙，但这种把函数叠在一起的方式，同时也叠加了函数的作用域，如果链条太长的话，也会对性能有较大的影响。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.after = function( fn )&#123;</span><br><span class="line">	var self = this;</span><br><span class="line">	return function()&#123;</span><br><span class="line">		var ret = self.apply( this, arguments );</span><br><span class="line">		if ( ret === &apos;nextSuccessor&apos; )&#123;</span><br><span class="line">			return fn.apply( this, arguments );</span><br><span class="line">		&#125;</span><br><span class="line">		return ret;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var order = order500.after( order200 ).after( orderNormal );</span><br><span class="line">order( 1, true, 500 ); // 输出：500 元定金预购，得到 100 优惠券</span><br><span class="line">order( 2, true, 500 ); // 输出：200 元定金预购，得到 50 优惠券</span><br><span class="line">order( 1, false, 500 ); // 输出：普通购买，无优惠券</span><br></pre></td></tr></table></figure></p>
<h3 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">function Player(name, teamColor)&#123;</span><br><span class="line">	this.name = name; //角色名字</span><br><span class="line">	this.teamColor = teamColor; //队伍颜色</span><br><span class="line">	this.state = &apos;alive&apos;;  //玩家生存状态</span><br><span class="line">&#125;;</span><br><span class="line">Player.prototype.win = function()&#123;</span><br><span class="line">	console.log(this.name+&apos; won&apos;);</span><br><span class="line">&#125;;</span><br><span class="line">Player.prototype.lose = function()&#123;</span><br><span class="line">	console.log(this.name+&apos; lost&apos;);</span><br><span class="line">&#125;;</span><br><span class="line">/*******玩家死亡*********/</span><br><span class="line">Player.prototype.die = function()&#123;</span><br><span class="line">	this.state = &apos;dead&apos;;</span><br><span class="line">	playerDirector.receiveMessage(&apos;playerDead&apos;, this); //给中介者发送信息，玩家死亡</span><br><span class="line">&#125;;</span><br><span class="line">/*******移除玩家******/</span><br><span class="line">Player.prototype.remove = function()&#123;</span><br><span class="line">	playerDirector.receiveMessage(&apos;removePlayer&apos;, this);  //给中介者发送信息，移除一个玩家</span><br><span class="line">&#125;;</span><br><span class="line">/*******玩家换队********/</span><br><span class="line">Player.prototype.changeTeam = function(color)&#123;</span><br><span class="line">	playerDirector.receiveMessage(&apos;changeTeam&apos;, this, color);  //给中介者发消息，玩家换队</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var playerFactory = function(name, teamColor)&#123;</span><br><span class="line">	var newPlayer = new Player(name, teamColor);  //创建一个新的玩家对象</span><br><span class="line">	playerDirector.receiveMessage(&apos;addPlayer&apos;, newPlayer);  //给中介者发送消息，新增玩家</span><br><span class="line">	return newPlayer;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var playerDirector = (function()&#123;</span><br><span class="line">	var players = &#123;&#125;,  //保存所有玩家</span><br><span class="line">		operations = &#123;&#125;; //中介者可以执行的操作</span><br><span class="line">	/*****新增一个玩家*****/</span><br><span class="line">	operations.addPlayer = function(player)&#123;</span><br><span class="line">		var teamColor = player.teamColor;  //玩家的队伍颜色</span><br><span class="line">		players[teamColor] = players[teamColor] || [];  //如果该颜色的玩家还没有成立队伍，则新成立一个队伍</span><br><span class="line">		players[teamColor].push(player);  //添加玩家进队伍</span><br><span class="line">	&#125;;</span><br><span class="line">	/***移除一个玩家****/</span><br><span class="line">	operations.removePlayer = function(player)&#123;</span><br><span class="line">		var teamColor = player.teamColor,   //玩家的队伍颜色</span><br><span class="line">			teamPlayers = players[teamColor] || []; //该队伍所有成员</span><br><span class="line">		for(var i=teamPlayers.length-1; i&gt;=0; i--)&#123;  //遍历删除</span><br><span class="line">			if(teamPlayers[i] === player)&#123;</span><br><span class="line">				teamPlayers.splice(i,1);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	/****玩家换队*****/</span><br><span class="line">	operations.changeTeam = function(player, newTeamColor)&#123;  //玩家换队</span><br><span class="line">		operations.removePlayer(player); //从原队伍中删除</span><br><span class="line">		player.teamColor = newTeamColor;  //改变队伍颜色</span><br><span class="line">		operations.addPlayer(player);   //增加到新队伍中</span><br><span class="line">	&#125;;</span><br><span class="line">	operations.playerDead = function(player)&#123;  //玩家死亡</span><br><span class="line">		var teamColor = player.teamColor,</span><br><span class="line">			teamPlayers = players[teamColor];  //玩家所在队伍</span><br><span class="line">		var all_dead = true;</span><br><span class="line">		for(var i=0,player; player=teamPlayers[i++];)&#123;</span><br><span class="line">			if(player.state !=== &apos;dead&apos;)&#123;</span><br><span class="line">				all_dead = false;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		if(all_dead === true)&#123;  //全部死亡</span><br><span class="line">			for(var i=0,player; player=teamPlayers[i++];)&#123;</span><br><span class="line">				player.lose();  //本队所有玩家lose</span><br><span class="line">			&#125;</span><br><span class="line">			for(var color in players)&#123;</span><br><span class="line">				if(color !=== teamColor)&#123;</span><br><span class="line">					var teamPlayers = players[color]; //其他队伍玩家</span><br><span class="line">					for(var i=0,player; player=teamPlayers[i++];)&#123;</span><br><span class="line">						player.win();  //其他队伍所有玩家win</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	var receiveMessage = function()&#123;</span><br><span class="line">		var message = Array.prototype.shift.call(arguments);  //arguments的第一个参数为消息名称</span><br><span class="line">		operations[message].apply(this, arguments);</span><br><span class="line">	&#125;;</span><br><span class="line">	return &#123;</span><br><span class="line">		receiveMessage: receiveMessage</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 红队：</span><br><span class="line">var player1 = playerFactory( &apos;皮蛋&apos;, &apos;red&apos; ),</span><br><span class="line">player2 = playerFactory( &apos;小乖&apos;, &apos;red&apos; ),</span><br><span class="line">player3 = playerFactory( &apos;宝宝&apos;, &apos;red&apos; ),</span><br><span class="line">player4 = playerFactory( &apos;小强&apos;, &apos;red&apos; );</span><br><span class="line">// 蓝队：</span><br><span class="line">var player5 = playerFactory( &apos;黑妞&apos;, &apos;blue&apos; ),</span><br><span class="line">player6 = playerFactory( &apos;葱头&apos;, &apos;blue&apos; ),</span><br><span class="line">player7 = playerFactory( &apos;胖墩&apos;, &apos;blue&apos; ),</span><br><span class="line">player8 = playerFactory( &apos;海盗&apos;, &apos;blue&apos; );</span><br><span class="line">player1.die();</span><br><span class="line">player2.die();</span><br><span class="line">player3.die();</span><br><span class="line">player4.die();</span><br></pre></td></tr></table></figure>
<p>选手机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">var goods = &#123; // 手机库存</span><br><span class="line">	&quot;red|32G&quot;: 3,</span><br><span class="line">	&quot;red|16G&quot;: 0,</span><br><span class="line">	&quot;blue|32G&quot;: 1,</span><br><span class="line">	&quot;blue|16G&quot;: 6</span><br><span class="line">&#125;;</span><br><span class="line">var mediator = (function()&#123;</span><br><span class="line">	var colorSelect = document.getElementById( &apos;colorSelect&apos; ),</span><br><span class="line">	memorySelect = document.getElementById( &apos;memorySelect&apos; ),</span><br><span class="line">	numberInput = document.getElementById( &apos;numberInput&apos; ),</span><br><span class="line">	colorInfo = document.getElementById( &apos;colorInfo&apos; ),</span><br><span class="line">	memoryInfo = document.getElementById( &apos;memoryInfo&apos; ),</span><br><span class="line">	numberInfo = document.getElementById( &apos;numberInfo&apos; ),</span><br><span class="line">	nextBtn = document.getElementById( &apos;nextBtn&apos; );</span><br><span class="line">	return &#123;</span><br><span class="line">		changed: function( obj )&#123;</span><br><span class="line">			var color = colorSelect.value, // 颜色</span><br><span class="line">			memory = memorySelect.value,// 内存</span><br><span class="line">			number = numberInput.value, // 数量</span><br><span class="line">			stock = goods[ color + &apos;|&apos; + memory ]; // 颜色和内存对应的手机库存数量</span><br><span class="line">			if ( obj === colorSelect )&#123; // 如果改变的是选择颜色下拉框</span><br><span class="line">				colorInfo.innerHTML = color;</span><br><span class="line">			&#125;else if ( obj === memorySelect )&#123;</span><br><span class="line">				memoryInfo.innerHTML = memory;</span><br><span class="line">			&#125;else if ( obj === numberInput )&#123;</span><br><span class="line">				numberInfo.innerHTML = number;</span><br><span class="line">			&#125;</span><br><span class="line">			if ( !color )&#123;</span><br><span class="line">				nextBtn.disabled = true;</span><br><span class="line">				nextBtn.innerHTML = &apos;请选择手机颜色&apos;;</span><br><span class="line">				return;</span><br><span class="line">			&#125;</span><br><span class="line">			if ( !memory )&#123;</span><br><span class="line">				nextBtn.disabled = true;</span><br><span class="line">				nextBtn.innerHTML = &apos;请选择内存大小&apos;;</span><br><span class="line">				return;</span><br><span class="line">			&#125;</span><br><span class="line">			if ( ( ( number - 0 ) | 0 ) !== number - 0 )&#123; // 输入购买数量是否为正整数</span><br><span class="line">				nextBtn.disabled = true;</span><br><span class="line">				nextBtn.innerHTML = &apos;请输入正确的购买数量&apos;;</span><br><span class="line">				return;</span><br><span class="line">			&#125;</span><br><span class="line">			nextBtn.disabled = false;</span><br><span class="line">			nextBtn.innerHTML = &apos;放入购物车&apos;;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br><span class="line">// 事件函数：</span><br><span class="line">colorSelect.onchange = function()&#123;</span><br><span class="line">	mediator.changed( this );</span><br><span class="line">&#125;;</span><br><span class="line">memorySelect.onchange = function()&#123;</span><br><span class="line">	mediator.changed( this );</span><br><span class="line">&#125;;</span><br><span class="line">numberInput.oninput = function()&#123;</span><br><span class="line">	mediator.changed( this );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h3 id="装饰着模式"><a href="#装饰着模式" class="headerlink" title="装饰着模式"></a>装饰着模式</h3><p>装饰者模式能够在不改变对象自身的基础上，在程序运行期间给对象动态地添加职责。跟继承相比，装饰者是一种更轻便灵活的做法，这是一种“即用即付”的方式。<br>用AOP装饰函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.before = function( beforefn )&#123;</span><br><span class="line">	var __self = this; // 保存原函数的引用</span><br><span class="line">	return function()&#123; // 返回包含了原函数和新函数的&quot;代理&quot;函数</span><br><span class="line">	beforefn.apply( this, arguments ); // 执行新函数，且保证 this 不被劫持，新函数接受的参数</span><br><span class="line">	// 也会被原封不动地传入原函数，新函数在原函数之前执行</span><br><span class="line">	return __self.apply( this, arguments ); // 执行原函数并返回原函数的执行结果，</span><br><span class="line">	// 并且保证 this 不被劫持</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">Function.prototype.after = function( afterfn )&#123;</span><br><span class="line">	var __self = this;</span><br><span class="line">	return function()&#123;</span><br><span class="line">		var ret = __self.apply( this, arguments );</span><br><span class="line">		afterfn.apply( this, arguments );</span><br><span class="line">		return ret;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">document.getElementById = document.getElementById.before(function()&#123;</span><br><span class="line">	alert (1);</span><br><span class="line">&#125;);</span><br><span class="line">var button = document.getElementById( &apos;button&apos; );</span><br><span class="line">console.log( button );</span><br><span class="line"></span><br><span class="line">window.onload = function()&#123;</span><br><span class="line">	alert (1);</span><br><span class="line">&#125;</span><br><span class="line">window.onload = ( window.onload || function()&#123;&#125; ).after(function()&#123;</span><br><span class="line">	alert (2);</span><br><span class="line">&#125;).after(function()&#123;</span><br><span class="line">	alert (3);</span><br><span class="line">&#125;).after(function()&#123;</span><br><span class="line">	alert (4);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="数据统计上报"><a href="#数据统计上报" class="headerlink" title="数据统计上报"></a>数据统计上报</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.after = function( afterfn )&#123;</span><br><span class="line">	var __self = this;</span><br><span class="line">	return function()&#123;</span><br><span class="line">		var ret = __self.apply( this, arguments );</span><br><span class="line">		afterfn.apply( this, arguments );</span><br><span class="line">		return ret;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var showLogin = function()&#123;</span><br><span class="line">	console.log( &apos;打开登录浮层&apos; );</span><br><span class="line">&#125;</span><br><span class="line">var log = function()&#123;</span><br><span class="line">	console.log( &apos;上报标签为: &apos; + this.getAttribute( &apos;tag&apos; ) );</span><br><span class="line">&#125;</span><br><span class="line">showLogin = showLogin.after( log ); // 打开登录浮层之后上报数据</span><br><span class="line">document.getElementById( &apos;button&apos; ).onclick = showLogin;</span><br></pre></td></tr></table></figure>
<p>插件式的表单验证<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.before = function( beforefn )&#123;</span><br><span class="line">	var __self = this;</span><br><span class="line">	return function()&#123;</span><br><span class="line">		if ( beforefn.apply( this, arguments ) === false )&#123;</span><br><span class="line">			// beforefn 返回 false 的情况直接 return，不再执行后面的原函数</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		return __self.apply( this, arguments );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">var validata = function()&#123;</span><br><span class="line">	if ( username.value === &apos;&apos; )&#123;</span><br><span class="line">		alert ( &apos;用户名不能为空&apos; );</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">	if ( password.value === &apos;&apos; )&#123;</span><br><span class="line">		alert ( &apos;密码不能为空&apos; );</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">var formSubmit = function()&#123;</span><br><span class="line">	var param = &#123;</span><br><span class="line">		username: username.value,</span><br><span class="line">		password: password.value</span><br><span class="line">	&#125;</span><br><span class="line">	ajax( &apos;http:// xxx.com/login&apos;, param );</span><br><span class="line">&#125;</span><br><span class="line">formSubmit = formSubmit.before( validata );</span><br><span class="line">submitBtn.onclick = function()&#123;</span><br><span class="line">	formSubmit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h3><p>允许一个对象在其内部状态改变时改变它的行为，对象看起来似乎修改了它的类。将状态封装成独立的类，并将请求委托给当前的状态对象，当对象的内部状态改变时，会带来不同的行为变化。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">var Light = function()&#123;</span><br><span class="line">	this.offLightState = new OffLightState( this ); // 持有状态对象的引用</span><br><span class="line">	this.weakLightState = new WeakLightState( this );</span><br><span class="line">	this.strongLightState = new StrongLightState( this );</span><br><span class="line">	this.superStrongLightState = new SuperStrongLightState( this );</span><br><span class="line">	this.button = null;</span><br><span class="line">&#125;;</span><br><span class="line">Light.prototype.init = function()&#123;</span><br><span class="line">	var button = document.createElement( &apos;button&apos; ),</span><br><span class="line">	self = this;</span><br><span class="line">	this.button = document.body.appendChild( button );</span><br><span class="line">	this.button.innerHTML = &apos;开关&apos;;</span><br><span class="line">	this.currState = this.offLightState; // 设置默认初始状态</span><br><span class="line">	this.button.onclick = function()&#123; // 定义用户的请求动作</span><br><span class="line">		self.currState.buttonWasPressed();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var OffLightState = function( light )&#123;</span><br><span class="line">	this.light = light;</span><br><span class="line">&#125;;</span><br><span class="line">OffLightState.prototype.buttonWasPressed = function()&#123;</span><br><span class="line">	console.log( &apos;弱光&apos; );</span><br><span class="line">	this.light.setState( this.light.weakLightState );</span><br><span class="line">&#125;;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>JavaScript 版本的状态机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">var Light = function()&#123;</span><br><span class="line">	this.currState = FSM.off; // 设置当前状态</span><br><span class="line">	this.button = null;</span><br><span class="line">&#125;;</span><br><span class="line">Light.prototype.init = function()&#123;</span><br><span class="line">	var button = document.createElement( &apos;button&apos; ),</span><br><span class="line">	self = this;</span><br><span class="line">	button.innerHTML = &apos;已关灯&apos;;</span><br><span class="line">	this.button = document.body.appendChild( button );</span><br><span class="line">	this.button.onclick = function()&#123;</span><br><span class="line">		self.currState.buttonWasPressed.call( self ); // 把请求委托给 FSM 状态机</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var FSM = &#123;</span><br><span class="line">	off: &#123;</span><br><span class="line">		buttonWasPressed: function()&#123;</span><br><span class="line">			console.log( &apos;关灯&apos; );</span><br><span class="line">			this.button.innerHTML = &apos;下一次按我是开灯&apos;;</span><br><span class="line">			this.currState = FSM.on;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	on: &#123;</span><br><span class="line">		buttonWasPressed: function()&#123;</span><br><span class="line">			console.log( &apos;开灯&apos; );</span><br><span class="line">			this.button.innerHTML = &apos;下一次按我是关灯&apos;;</span><br><span class="line">			this.currState = FSM.off;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var light = new Light();</span><br><span class="line">light.init();</span><br><span class="line"></span><br><span class="line">var delegate = function( client, delegation )&#123;</span><br><span class="line">	return &#123;</span><br><span class="line">		buttonWasPressed: function()&#123; // 将客户的操作委托给 delegation 对象</span><br><span class="line">			return delegation.buttonWasPressed.apply( client, arguments );</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var FSM = &#123;</span><br><span class="line">	off: &#123;</span><br><span class="line">		buttonWasPressed: function()&#123;</span><br><span class="line">			console.log( &apos;关灯&apos; );</span><br><span class="line">			this.button.innerHTML = &apos;下一次按我是开灯&apos;;</span><br><span class="line">			this.currState = this.onState;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	on: &#123;</span><br><span class="line">		buttonWasPressed: function()&#123;</span><br><span class="line">			console.log( &apos;开灯&apos; );</span><br><span class="line">			this.button.innerHTML = &apos;下一次按我是关灯&apos;;</span><br><span class="line">			this.currState = this.offState;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var Light = function()&#123;</span><br><span class="line">	this.offState = delegate( this, FSM.off );</span><br><span class="line">	this.onState = delegate( this, FSM.on );</span><br><span class="line">	this.currState = this.offState; // 设置初始状态为关闭状态</span><br><span class="line">	this.button = null;</span><br><span class="line">&#125;;</span><br><span class="line">Light.prototype.init = function()&#123;</span><br><span class="line">	var button = document.createElement( &apos;button&apos; ),</span><br><span class="line">	self = this;</span><br><span class="line">	button.innerHTML = &apos;已关灯&apos;;</span><br><span class="line">	this.button = document.body.appendChild( button );</span><br><span class="line">	this.button.onclick = function()&#123;</span><br><span class="line">		self.currState.buttonWasPressed();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">var light = new Light();</span><br><span class="line">light.init();</span><br></pre></td></tr></table></figure></p>
<h3 id="适配器模式-包装器"><a href="#适配器模式-包装器" class="headerlink" title="适配器模式(包装器)"></a>适配器模式(包装器)</h3><p>适配器模式的作用是解决两个软件实体间的接口不兼容的问题。使用适配器模式之后，原本由于接口不兼容而不能工作的两个软件实体可以一起工作。</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/22/basic-check/" rel="next" title="姓名，身份证校验">
                <i class="fa fa-chevron-left"></i> 姓名，身份证校验
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/02/05/websafe/" rel="prev" title="浏览器安全">
                浏览器安全 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/uploads/head.jpeg" alt="Chris Han">
          <p class="site-author-name" itemprop="name">Chris Han</p>
           
              <p class="site-description motion-element" itemprop="description">一人一世界</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#单例模式"><span class="nav-number">1.</span> <span class="nav-text">单例模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#用代理实现单例模式"><span class="nav-number">1.1.</span> <span class="nav-text">用代理实现单例模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#js中的单例模式"><span class="nav-number">1.2.</span> <span class="nav-text">js中的单例模式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#使用命名空间-减少全局变量的数量"><span class="nav-number">1.2.1.</span> <span class="nav-text">使用命名空间,减少全局变量的数量</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#使用闭包封装私有变量，只暴露一些接口跟外界通信"><span class="nav-number">1.2.2.</span> <span class="nav-text">使用闭包封装私有变量，只暴露一些接口跟外界通信</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#惰性单例"><span class="nav-number">1.3.</span> <span class="nav-text">惰性单例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#策略模式"><span class="nav-number">2.</span> <span class="nav-text">策略模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#使用策略模式重构表单校验"><span class="nav-number">2.1.</span> <span class="nav-text">使用策略模式重构表单校验</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代理模式"><span class="nav-number">3.</span> <span class="nav-text">代理模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#虚拟代理实现图片预加载"><span class="nav-number">3.1.</span> <span class="nav-text">虚拟代理实现图片预加载</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#虚拟代理合并http请求"><span class="nav-number">3.2.</span> <span class="nav-text">虚拟代理合并http请求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用高阶函数动态创建代理"><span class="nav-number">3.3.</span> <span class="nav-text">用高阶函数动态创建代理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#迭代器模式"><span class="nav-number">4.</span> <span class="nav-text">迭代器模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#发布-订阅模式（观察者模式）"><span class="nav-number">5.</span> <span class="nav-text">发布-订阅模式（观察者模式）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#真实的例子——网站登录"><span class="nav-number">5.1.</span> <span class="nav-text">真实的例子——网站登录</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命令模式"><span class="nav-number">6.</span> <span class="nav-text">命令模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组合模式"><span class="nav-number">7.</span> <span class="nav-text">组合模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模板方法模式"><span class="nav-number">8.</span> <span class="nav-text">模板方法模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#享元模式"><span class="nav-number">9.</span> <span class="nav-text">享元模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#职责链模式"><span class="nav-number">10.</span> <span class="nav-text">职责链模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#中介者模式"><span class="nav-number">11.</span> <span class="nav-text">中介者模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#装饰着模式"><span class="nav-number">12.</span> <span class="nav-text">装饰着模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#数据统计上报"><span class="nav-number">12.1.</span> <span class="nav-text">数据统计上报</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态模式"><span class="nav-number">13.</span> <span class="nav-text">状态模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#适配器模式-包装器"><span class="nav-number">14.</span> <span class="nav-text">适配器模式(包装器)</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chris Han</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

<br>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

本站总访问量 <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp
您是第<span id="busuanzi_value_site_uv"></span>个来到的小伙伴
        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
